name: Build and Deploy
on: [push, workflow_dispatch] # Trigger this action manually - and temporarily on push
jobs:
  build_and_deploy_to_test:
    container: python:latest
    steps:
      - run: bin/setup.sh
      - run: bin/deploy.sh
    variables:
      PIP_CACHE_DIR: "$CI_PROJECT_DIR/.cache/pip"
      HTACCESS_VARIANT: .test
      ENABLE_HYPOTHESIS: "true"
      ROBOTS_DIRECTIVE: "noindex"

  build_and_deploy_to_prod:
    if: contains( github.ref, 'master') # Only run this action for the master branch
    container: python:latest
    steps:
      - run: bin/setup.sh
      - run: bin/deploy.sh
    variables:
      PIP_CACHE_DIR: "$CI_PROJECT_DIR/.cache/pip"
      HTACCESS_VARIANT: .live
